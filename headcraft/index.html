<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="description" content="HeadCraft: Modeling High-Detail Shape Variations for Animated 3DMMs">
    <meta name="keywords" content="HeadCraft, 3DMM, FLAME, Offsets">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>HeadCraft: Modeling High-Detail Shape Variations for Animated 3DMMs</title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro" rel="stylesheet">

    <link rel="stylesheet" href="./static/css/bulma.min.css">
    <link rel="stylesheet" href="./static/css/bulma-carousel.min.css">
    <link rel="stylesheet" href="./static/css/bulma-slider.min.css">
    <link rel="stylesheet" href="./static/css/fontawesome.all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css">
    <link rel="stylesheet" href="./static/css/index.css">

    <style>
		.render_wrapper {
			position: relative;
            height: 300px;
         }
        .render_wrapper_small {
			position: relative;
            height: 200px;
         }
		.render_div {
			position: absolute;
			top: 0;
			left: 0;
		}

        #interpolation-image-wrapper-car{
            text-align: center;
        }
        #interpolation-image-wrapper-chair{
            text-align: center;
        }
        .nested-columns {
            margin-bottom: 0 !important;
        }
    </style>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script defer src="./static/js/fontawesome.all.min.js"></script>
    <script src="./static/js/bulma-carousel.min.js"></script>
    <script src="./static/js/bulma-slider.min.js"></script>
    <script src="./static/js/index.js"></script>
    <script src="https://unpkg.com/interactjs/dist/interact.min.js"></script>
</head>

<body>

  
    <!-- ====================================================== -->
    <!-- ===================== AUTHORS ========================== -->
    <!-- ====================================================== -->

    <section class="hero">
        <div class="hero-body">
            <div class="container is-max-desktop">
                <div class="columns is-centered">
                    <div class="column has-text-centered">
                        <h1 class="title is-1 publication-title">HeadCraft: Modeling High-Detail Shape Variations for Animated 3DMMs</h1>
                        <center>
                          <div class="columns publication-authors" style="margin-bottom: 0px; margin-top: 10px;">
                            <!-- <div class="col-sm-12"> -->
                            <div class="column ">
                                <a href="https://seva100.github.io">
                                    <div onmouseout="artem_stop()" onmouseover="artem_start()">
                                        <div class="hover_outer">
                                            <div class="hover_inner" id='artem_image' style="width: 130px; height: 130px; margin-left: 5px">    
                                            <img src='assets/headcraft/coauthors_photos/Artem.jpeg'>
                                        </div>
                                        <video class="hover_video" id='artem_video' width=100% height=100% muted autoplay loop>
                                            <source src="assets/headcraft/coauthors_videos/Artem.mp4_compat.mp4" type="video/mp4">
                                            Your browser does not support the video tag.
                                        </video>
                                        </div>
                                        <script type="text/javascript">
                                            function artem_start() {
                                            document.getElementById('artem_image').style.opacity = "1";
                                            document.getElementById('artem_video').style.opacity = "0";
                                            }
                        
                                            function artem_stop() {
                                            document.getElementById('artem_image').style.opacity = "0";
                                            document.getElementById('artem_video').style.opacity = "1";
                                            }
                                            artem_stop()
                                        </script>
                                        </div>
                                  <!-- <video class="rgb" height="100%" muted autoplay loop width="100%">
                                    <source src="assets/headcraft/coauthors_videos/Artem.mp4" type="video/mp4"/>
                                  </video> -->
                                  <div class="author-block">Artem Sevastopolsky</div><br><div class="affiliation">TUM</div>
                                </a>
                              </div>
                              <div class="column" style="margin-bottom: 10px">
                                <!-- <div class="col-sm-12"> -->
                                <a href="https://scholar.google.de/citations?user=WMFKDiwAAAAJ&hl=de">
                                    <div onmouseout="philip_stop()" onmouseover="philip_start()">
                                        <div class="hover_outer">
                                            <div class="hover_inner" id='philip_image' style="width: 130px; height: 130px; margin-left: 5px">    
                                            <img src='assets/headcraft/coauthors_photos/Philip.jpeg'>
                                        </div>
                                        <video class="hover_video" id='philip_video' width=100% height=100% muted autoplay loop>
                                            <source src="assets/headcraft/coauthors_videos/Philip.mp4_compat.mp4" type="video/mp4">
                                            Your browser does not support the video tag.
                                        </video>
                                        </div>
                                        <script type="text/javascript">
                                            function philip_start() {
                                            document.getElementById('philip_image').style.opacity = "1";
                                            document.getElementById('philip_video').style.opacity = "0";
                                            }
                        
                                            function philip_stop() {
                                            document.getElementById('philip_image').style.opacity = "0";
                                            document.getElementById('philip_video').style.opacity = "1";
                                            }
                                            philip_stop()
                                        </script>
                                        </div>
                                  <!-- <video class="rgb" height="100%"  muted autoplay loop width="100%">
                                    <source src="assets/headcraft/coauthors_videos/Philip.mp4" type="video/mp4"/>
                                  </video> -->
                                  <div class="author-block">Philip-William Grassal</div><br><div class="affiliation">Copresence AG</div> 
                                </a>
                              </div>
                              <div class="column" style="margin-bottom: 10px">
                                <!-- <div class="col-sm-12"> -->
                                <a href="https://simongiebenhain.github.io/">
                                    <div onmouseout="simon_stop()" onmouseover="simon_start()">
                                        <div class="hover_outer">
                                            <div class="hover_inner" id='simon_image' style="width: 130px; height: 130px; margin-left: 5px">    
                                            <img src='assets/headcraft/coauthors_photos/Simon.JPG'>
                                        </div>
                                        <video class="hover_video" id='simon_video' width=100% height=100% muted autoplay loop>
                                            <source src="assets/headcraft/coauthors_videos/Simon.mp4_compat.mp4" type="video/mp4">
                                            Your browser does not support the video tag.
                                        </video>
                                        </div>
                                        <script type="text/javascript">
                                            function simon_start() {
                                            document.getElementById('simon_image').style.opacity = "1";
                                            document.getElementById('simon_video').style.opacity = "0";
                                            }
                        
                                            function simon_stop() {
                                            document.getElementById('simon_image').style.opacity = "0";
                                            document.getElementById('simon_video').style.opacity = "1";
                                            }
                                            simon_stop()
                                        </script>
                                        </div>
                                  <!-- <video class="rgb" height="100%"  muted autoplay loop width="100%">
                                    <source src="assets/headcraft/coauthors_videos/Simon.mp4" type="video/mp4"/>
                                  </video> -->
                                  <div class="author-block">Simon Giebenhain</div><br><div class="affiliation">TUM</div>
                                </a>
                              </div>
                              <div class="column " style="margin-bottom: 10px">
                                <!-- <div class="col-sm-12"> -->
                                <a href="https://shahrukhathar.github.io/">
                                    <div onmouseout="shahrukh_stop()" onmouseover="shahrukh_start()">
                                        <div class="hover_outer">
                                            <div class="hover_inner" id='shahrukh_image' style="width: 130px; height: 130px; margin-left: 5px">    
                                            <img src='assets/headcraft/coauthors_photos/ShahRukh2.jpg'>
                                        </div>
                                        <video class="hover_video" id='shahrukh_video' width=100% height=100% muted autoplay loop>
                                            <source src="assets/headcraft/coauthors_videos/ShahRukh.mp4_compat.mp4" type="video/mp4">
                                            Your browser does not support the video tag.
                                        </video>
                                        </div>
                                        <script type="text/javascript">
                                            function shahrukh_start() {
                                            document.getElementById('shahrukh_image').style.opacity = "1";
                                            document.getElementById('shahrukh_video').style.opacity = "0";
                                            }
                        
                                            function shahrukh_stop() {
                                            document.getElementById('shahrukh_image').style.opacity = "0";
                                            document.getElementById('shahrukh_video').style.opacity = "1";
                                            }
                                            shahrukh_stop()
                                        </script>
                                        </div>
                                  <!-- <video class="rgb" height="100%"  muted autoplay loop width="100%">
                                    <source src="assets/headcraft/coauthors_videos/ShahRukh.mp4" type="video/mp4"/>
                                  </video> -->
                                  <div class="author-block">ShahRukh Athar</div><br><div class="affiliation">Stony Brook University</div>
                                </a>
                              </div>
                              <div class="column " style="margin-bottom: 10px">
                                  <div onmouseout="annalisa_stop()" onmouseover="annalisa_start()">
                                    <div class="hover_outer">
                                      <div class="hover_inner" id='annalisa_image' style="width: 130px; height: 130px; margin-left: 5px">    
                                      <img src='assets/headcraft/coauthors_photos/Annalisa2.jpg'>
                                    </div>
                                    <video class="hover_video" id='annalisa_video' width=100% height=100% muted autoplay loop>
                                        <source src="assets/headcraft/coauthors_videos/Annalisa.mp4_compat.mp4" type="video/mp4">
                                        Your browser does not support the video tag.
                                    </video>
                                    </div>
                                    <script type="text/javascript">
                                      function annalisa_start() {
                                        document.getElementById('annalisa_image').style.opacity = "1";
                                        document.getElementById('annalisa_video').style.opacity = "0";
                                      }
                    
                                      function annalisa_stop() {
                                        document.getElementById('annalisa_image').style.opacity = "0";
                                        document.getElementById('annalisa_video').style.opacity = "1";
                                      }
                                      annalisa_stop()
                                    </script>
                                    </div>
                                  <!-- </td> -->
                                  <!-- <video class="rgb" height="100%"  muted autoplay loop width="100%">
                                    <source src="assets/headcraft/coauthors_videos/Annalisa.mp4" type="video/mp4"/>
                                  </video>
                                  <img src='assets/headcraft/coauthors_photos/Annalisa.jpg' width="256"> -->
                                <a href="https://www.grip.unina.it/members/verdoliva">
                                  <div class="author-block">Luisa Verdoliva</div><br><div class="affiliation">University of Naples Federico II, TUM</div>
                                </a>
                              </div>
                              <div class="column " style="margin-bottom: 10px">
                                <!-- <div class="col-sm-12"> -->
                                <a href="https://www.niessnerlab.org/members/matthias_niessner/profile.html">
                                    <div onmouseout="matthias_stop()" onmouseover="matthias_start()">
                                        <div class="hover_outer">
                                            <div class="hover_inner" id='matthias_image' style="width: 130px; height: 130px; margin-left: 5px">    
                                            <img src='assets/headcraft/coauthors_photos/Matthias.JPG'>
                                        </div>
                                        <video class="hover_video" id='matthias_video' width=100% height=100% muted autoplay loop>
                                            <source src="assets/headcraft/coauthors_videos/Matthias.mp4_compat.mp4" type="video/mp4">
                                            Your browser does not support the video tag.
                                        </video>
                                        </div>
                                        <script type="text/javascript">
                                            function matthias_start() {
                                            document.getElementById('matthias_image').style.opacity = "1";
                                            document.getElementById('matthias_video').style.opacity = "0";
                                            }
                        
                                            function matthias_stop() {
                                            document.getElementById('matthias_image').style.opacity = "0";
                                            document.getElementById('matthias_video').style.opacity = "1";
                                            }
                                            matthias_stop()
                                        </script>
                                        </div>
                                  <!-- <video class="rgb" height="100%"  muted autoplay loop width="100%">
                                    <source src="assets/headcraft/coauthors_videos/Matthias.mp4" type="video/mp4"/>
                                  </video> -->
                                  <div class="author-block">Matthias Nießner</div><br><div class="affiliation">TUM</div>
                                </a>
                              </div>
                          </div>
                        </center>

                        <div class="column has-text-centered">
                            <div class="publication-links">
                                <!-- PDF Link. -->
                                <span class="link-block">
                                    <a href="static/HeadCraft.pdf"
                                        class="external-link button is-normal is-rounded is-dark">
                                        <span class="icon">
                                            <i class="fas fa-file-pdf"></i>
                                        </span>
                                        <span>Paper</span>
                                    </a>
                                </span>
                                <span class="link-block">
                                    <a class="external-link button is-normal is-rounded is-dark" href="https://arxiv.org/abs/2312.14140">
                                        <span class="icon">
                                            <i class="ai ai-arxiv"></i>
                                        </span>
                                        <span>arXiv</span>
                                    </a>
                                </span>
                                <!-- Video Link. -->
                                <span class="link-block">
                                    <a href="https://youtu.be/uBeBT2f1CL0"
                                        class="external-link button is-normal is-rounded is-dark">
                                        <span class="icon">
                                            <svg class="svg-inline--fa fa-youtube fa-w-18" aria-hidden="true"
                                                focusable="false" data-prefix="fab" data-icon="youtube" role="img"
                                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"
                                                data-fa-i2svg="">
                                                <path fill="currentColor"
                                                    d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z">
                                                </path>
                                            </svg><!-- <i class="fab fa-youtube"></i> Font Awesome fontawesome.com -->
                                        </span>
                                        <span>Video</span>
                                    </a>
                                </span>


                                <!-- Github Link. -->
                                <span class="link-block">
                                    <a href="https://github.com/seva100/headcraft/" class="external-link button is-normal is-rounded is-dark">
                                        <span class="icon">
                                            <i class="fab fa-github"></i>
                                        </span>
                                        <span>Code</span>
                                    </a>
                                </span>
                                <!-- Dataset Link. -->
                                <span class="link-block"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ====================================================== -->
    <!-- ===================== TEASER ======================= -->
    <!-- ====================================================== -->

    <section class="hero teaser">
        <div class="container is-max-desktop">
            <div class="hero-body" style="text-align: center">
                <div style="display: flex; justify-content: center; align-items: center; padding-top: 0; padding-bottom: 0">
                    <img src="/images/projects/headcraft/teaser.png" style="max-height: 350px"/>
                </div>
                <h2 class="subtitle has-text-left" style="padding-top: 20px">
                  We present <span class="dnerf">HeadCraft</span>, a generative model for highly-detailed human heads, ready for animation. Our method is trained on 2D displacement maps collected by registering a parametric template head with free surface displacements to a large set of 3D head scans. The resulting model is highly versatile, which can be demonstrated by fitting the latent code of the model to an arbitrary depth observation.
                </h2>
            </div>
        </div>
    </section>


    <!-- ================================================================ -->
    <!-- ===================== RANDOM GENERATIONS ======================= -->
    <!-- ================================================================ -->

    <section class="hero is-light is-small is-hidden-touch">
        <div class="hero-body">
          <div class="container">
              <div id="results-carousel" class="carousel results-carousel">
                  <div class="item item-steve render_wrapper"> 
                <div id="mesh_0" class="render_div"></div>
                  </div>
                  <div class="item item-steve render_wrapper">
                <div id="mesh_1" class="render_div"></div>
                  </div>
                  <div class="item item-steve render_wrapper">
                <div id="mesh_2" class="render_div"></div>
                  </div>
                  <div class="item item-steve render_wrapper">
                <div id="mesh_3" class="render_div"></div>
                  </div>
                  <!-- <div class="item item-steve render_wrapper">
                <div id="mesh_4" class="render_div"></div>
                  </div>
                  <div class="item item-steve render_wrapper">
                <div id="mesh_5" class="render_div"></div>
                  </div>
                  <div class="item item-steve render_wrapper">
                <div id="mesh_6" class="render_div"></div> 
                  </div>
                  <div class="item item-steve render_wrapper">
                <div id="mesh_7" class="render_div"></div>
                  </div> -->
              </div>
          </div>
          <div style="text-align: center;">Click and rotate with the mouse. Press <b>G</b> to toggle wireframe, <b>R</b> to reset view. </div>
        </div>
        </div>
    </section>

    <!-- ====================================================== -->
    <!-- ===================== ABSTRACT ======================= -->
    <!-- ====================================================== -->

    <section class="section">
        <div class="container is-max-desktop">
            <!-- Abstract. -->
            <div class="columns is-centered has-text-centered">
                <div class="column is-four-fifths">
                    <h2 class="title is-3">Abstract</h2>
                    <div class="content has-text-justified">
                        <p>Current advances in human head modeling allow to generate plausible-looking 3D head models via neural representations, such as NeRFs and SDFs. Nevertheless, constructing complete high-fidelity head models with explicitly controlled animation remains an issue. Furthermore, completing the head geometry based on a partial observation, e.g. coming from a depth sensor, while preserving a high level of detail is often problematic for the existing methods.
                        <!-- We introduce <span class="dnerf">MeshGPT</span>, a new approach for generating triangle meshes that reflects the compactness typical of artist-created meshes, in contrast to dense triangle meshes extracted by iso-surfacing methods from neural fields. Inspired by recent advances in powerful large language models, we adopt a sequence-based approach to autoregressively generate triangle meshes as sequences of triangles. -->
                        </p>
                        <p>
                        We introduce a generative model for detailed 3D head meshes on top of an articulated 3DMM which allows explicit animation and high-detail preservation at the same time. Our method is trained in two stages. First, we register a parametric head model with vertex displacements to each mesh of the recently introduced NPHM dataset of accurate 3D head scans. The estimated displacements are baked into a hand-crafted UV layout. Second, we train a StyleGAN model in order to generalize over the UV maps of displacements, which we later refer to HeadCraft. The decomposition of the parametric model and high-quality vertex displacements allows us to animate the model and modify the regions semantically. We demonstrate the results of unconditional generation and fitting to the full or partial observation.
                        </p>
                    </div>
                </div>
            </div>

            <!-- ====================================================== -->
            <!-- ===================== VIDEO ======================= -->
            <!-- ====================================================== -->
            <!-- Paper video. -->
            <div class="columns is-centered has-text-centered">
                <div class="column is-four-fifths">
                    <h2 class="title is-3">Video</h2>
                    <div class="publication-video">
                    <iframe src="https://youtube.com/embed/uBeBT2f1CL0" title="HeadCraft: Modeling High-Detail Shape Variations for Animated 3DMMs" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                    </div>
                </div>
            </div>
            <!--/ Paper video. -->
        </div>
    </section>

    <!-- =============================================================================== -->
    <!-- ===================== Interpolation in the Latent Space ======================= -->
    <!-- =============================================================================== -->
    <section class="section is-hidden-touch">
      <div class="container is-max-desktop">
          <div class="container is-max-desktop">
              <div class="content has-text-justified">
                  <h2 class="title is-3">Interpolation in the Latent Space</h2>
                    <p>
                Here is an interactive viewer allowing for latent interpolation. Generated displacements are applied to the same FLAME template here. 
                Drag the <span style="color: #29e">blue cursor</span>
                around to linearly interpolate between four different latents.
                The resulting geometry from three views is displayed on the right. 
            </p>
              </div>
      <div class="columns is-centered is-vcentered">
        <div class="column is-one-third">
          <div class="hyper-space-wrapper-shape has-text-centered">
            <div class="hyper-space-axis-shape">
              <div class="hyper-space-shape-outer">
                  <div class="hyper-space-shape">
                      <div class="hyper-space-cursor-shape"></div>
                </div>
              </div>
            </div>
            Latent Shape Coordinates
            <br/>
            <small>(Quadrilateral linear interpolation between 4 cornering latents.)</small>
          </div>
        </div>
        <div class="column is-two-thirds has-text-centered">
          <div class="hyper-grid-wrapper-shape">
            <div class="hyper-grid-rgb-shape">
              <img width=1000 src="/images/projects/headcraft/quadrilateral_grid.jpg"/>
            </div>
          </div>
          Corresponding geometry from three views (frontal, side, top).
        </div>
      </div>
    </div>
    </div>
    </section>


    <!-- ============================================================= -->
    <!-- ===================== METHOD OVERVIEW ======================= -->
    <!-- ============================================================= -->
    <section class="section">
        <div class="container is-max-desktop">

            <!-- Overview. -->
            <div class="columns is-centered" style="margin-top: 15px">
                <div class="column is-full-width">
                    <h2 class="title is-4">Method Overview</h2>
                    <img src="/images/projects/headcraft/method.png" alt="reconstruction_small">
                    <div class="content has-text-justified" style="padding-top: 15px">
                      In the registration stage, we <b>(a)</b> fit the FLAME template by the face landmarks to the scan from the
                      NPHM dataset and highly subdivide it, <b>(b)</b> optimize for the vector displacements for vertices to fit the rough geometry with strong regularizations,
                      <b>(c)</b> optimize for the scalar refinements of the displacements along the normal directions, and <b>(d)</b> bake the displacements into a UV offset
                      map. To generalize over the UV offset maps, we train a StyleGAN2 model. After training, the offsets can be applied to an arbitrary
                      FLAME template by subdividing it and <b>(e)</b> querying the generated UV offset map with the <i>(u, v)</i> locations of the FLAME vertices.</p>
                    </div>
                </div>
            </div>


            <!--
            <div class="columns is-centered has-text-centered">
                <div class="column is-four-fifths">
                    <h2 class="title is-3">Method Overview</h2>
                </div>
            </div>
            <section class="hero teaser">
                <div class="container is-max-desktop">
                    <div class="hero-body">
                        <img src="./static/teaser/overview.jpg"/>
                    </div>
                </div>
            </section>
            <div class="columns is-centered has-text-centered">
                <div class="column is-four-fifths">
                    <div class="content has-text-justified">
                        <p>Surface features from an input 3D mesh are encoded through a face convolution-based encoder and decoded through a StyleGAN2-inspired decoder to generate textures directly on the surface of the mesh.</p>
                        <p>To ensure that generated textures are realistic, the textured mesh is differentiably rendered from different view points and is critiqued by two discriminators.</p>
                        <p>An image discriminator D<sub>I</sub> operates on full image views from the real or rendered views, while a patch-consistency discriminator D<sub>P</sub> encourages consistency between views by operating on patches coming from a single real view or patches from different views of rendered images.</p>
                    </div>
                </div>
            </div>
          -->

            <!-- ====================================================== -->
            <!-- ===================== RELATED LINKS ======================= -->
            <!-- ====================================================== -->
            <br>
            <div class="columns is-centered">
                <div class="column is-full-width">
                    <h2 class="title is-3">Related Links</h2>

                    <div class="content has-text-justified">
                        <p>
                            For more work on similar tasks, please check out:
                        </p>
                        <p>
                            <li><a href="https://simongiebenhain.github.io/NPHM/">NPHM</a> learns a parametric head model over a set of manually collected high-fidelity head scans. The head is represented as an SDF modeled as an ensemble of MLPs and can be controlled by identity and expression. <a href="https://simongiebenhain.github.io/MonoNPHM/">MonoNPHM</a> adds a color model and extends NPHM to monocular RGB images. </li>
                        </p>
                        <p>
                            <li><a href="https://sizhean.github.io/panohead">PanoHead</a> extends <a href="https://nvlabs.github.io/eg3d/">EG3D</a> with 360° head representation. </li>
                        </p>
                        <p>
                            <li><a href="http://www.liuyebin.com/faceverse/faceverse.html">FaceVerse</a> learns a neural face model over a set of collected high-quality RGB-D head scans.  </li>
                        </p>
                        <p>
                            <li><a href="https://philgras.github.io/neural_head_avatars/neural_head_avatars.html">Neural Head Avatars</a> and <a href="https://samsunglabs.github.io/rome/">ROME</a> represent the head as a combination of FLAME and displacements to either fit it to a multi-view talking head video or to a single image. </li>
                        </p>
                    </div>
                </div>
            </div>
        </div>
      </section>

    <!-- ====================================================== -->
    <!-- ===================== BibTeX ======================= -->
    <!-- ====================================================== -->
    <section class="section" id="BibTeX">
        <div class="container is-max-desktop content">
            <h2 class="title">BibTeX</h2>
            <pre>
                <code>
@article{sevastopolsky2023headcraft,
  title={HeadCraft: Modeling High-Detail Shape Variations for Animated 3DMMs},
  author={Sevastopolsky, Artem and Grassal, Philip-William and Giebenhain, Simon and Athar, Shah{R}ukh and Verdoliva, Luisa and Nie{\ss}ner, Matthias},
  publisher={arXiv},
  primaryClass={cs.CV},
  year={2023}
}</code>
            </pre>
        </div>
    </section>


    <footer class="footer">
        <div class="container">
            <div class="content has-text-centered">
                <a class="icon-link" href="static/HeadCraft.pdf">
                    <i class="fas fa-file-pdf"></i>
                </a>
                <a class="icon-link" href="https://github.com/seva100/headcraft/" class="external-link">
                    <i class="fab fa-github"></i>
                </a>
            </div>
            <div class="columns is-centered">
                <div class="column is-8">
                    <div class="content">
                        <p style="text-align:center">
                            Source code mainly borrowed from <a href="https://keunhong.com/">Keunhong Park</a>'s <a
                                href="https://nerfies.github.io/">Nerfies website</a>, its <a href="https://niessnerlab.org/members/yawar_siddiqui/profile.html">Yawar Siddiqui</a>'s adoption for <a href="https://nihalsid.github.io/texturify//">Texturify</a> and <a href="https://simongiebenhain.github.io/">Simon Giebenhain</a>'s adoption for <a href="https://simongiebenhain.github.io/NPHM/">NPHM</a>.
                        </p>
                        <p style="text-align:center">
                            Please contact <a href="https://seva100.github.io/">Artem Sevastopolsky</a> for feedback and questions.
                        </p>

                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Import maps polyfill -->
    <!-- Remove this when import maps will be widely supported -->
    <script async src="https://unpkg.com/es-module-shims@1.3.6/dist/es-module-shims.js"></script>

    <script type="importmap">
        {
            "imports": {
                "three": "/js/three.module.js"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';

    import { PLYLoader } from './js/PLYLoader.js';
    import { OrbitControls } from './js/OrbitControls.js'
    let div_to_scene = {
        "mesh_0": {
            "geo": null,
            "color": null,
        },
        "mesh_1": {
            "geo": null,
            "color": null,
        },
        "mesh_2": {
            "geo": null,
            "color": null,
        },
        "mesh_3": {
            "geo": null,
            "color": null,
        },
        "mesh_4": {
            "geo": null,
            "color": null,
        },
        "mesh_5": {
            "geo": null,
            "color": null,
        },
        "mesh_6": {
            "geo": null,
            "color": null,
        },
        "mesh_7": {
            "geo": null,
            "color": null,
        }
    }
    let div_to_render_scene = {
        "mesh_style_0": {
            "0": null,
            "1": null,
            "2": null,
            "geo": null,
        },
        "mesh_style_1": {
            "0": null,
            "1": null,
            "2": null,
            "geo": null,
        },
        "mesh_style_2": {
            "0": null,
            "1": null,
            "2": null,
            "geo": null,
        },
        "mesh_style_3": {
            "0": null,
            "1": null,
            "2": null,
            "geo": null,
        },
    }
    let mouse_button_down = false;
    let list_of_orbit_controls = []
    let style_camera = null;
    let render_colors = false;
    let style_id = "0"

    function setup_camera(div_name){
        let container = document.getElementById(div_name);
        let width = container.parentElement.clientWidth;
        let height = container.parentElement.clientHeight;
        let camera = new THREE.PerspectiveCamera( 35, width / height, 0.1, 100 );

        // let camera_init_position = new THREE.Vector3( 2.25, 1.525, -3.75 );
        let camera_init_position = new THREE.Vector3( -50, 7.5, 30 );
        // camera_init_position = camera_init_position.multiplyScalar(0.55)
        camera.position.set(camera_init_position.x, camera_init_position.y, camera_init_position.z);
        return camera;
    }

    function setup_render_divs(div_name, mesh_path){
        let camera = setup_camera(div_name)
        let orbit_control = create_render_div(camera, div_name, mesh_path)
        list_of_orbit_controls.push(orbit_control)
    }

    function create_render_div(camera, div_id, mesh_path) {
        let container;
        let renderer, controls;

        init();
        animate();

        function init() {

            container = document.getElementById(div_id);
            let width = container.parentElement.clientWidth;
            let height = container.parentElement.clientHeight;


            div_to_scene[div_id]["color"] = new THREE.Scene();
            div_to_scene[div_id]["geo"] = new THREE.Scene();
            div_to_scene[div_id]["color"].background = new THREE.Color( 0xffffff );
            div_to_scene[div_id]["geo"].background = new THREE.Color( 0xffffff );

            // PLY file

            const loader = new PLYLoader();
            loader.load( mesh_path, function ( geometry ) {

                geometry.computeVertexNormals();
                let material_color = new THREE.MeshStandardMaterial( { color: 0xaaaaaa, flatShading: true, side: THREE.DoubleSide } )
                // let material_geo = new THREE.MeshStandardMaterial( { color: 0x444444, flatShading: true, side: THREE.DoubleSide } )
                let material_geo = new THREE.MeshStandardMaterial( { color: 0x444444, flatShading: true, side: THREE.DoubleSide, metalness: 0.0, roughness: 0.7 } )

                let wireframe = new THREE.WireframeGeometry( geometry );
                let line = new THREE.LineSegments( wireframe );
                line.material.color.setHex(0x000000);

                const mesh_color = new THREE.Mesh( geometry, material_color );
                const mesh_geo = new THREE.Mesh( geometry, material_geo );

                div_to_scene[div_id]["color"].add( mesh_color );
                div_to_scene[div_id]["color"].add(line);
                div_to_scene[div_id]["geo"].add( mesh_geo );

            }, (xhr) => {
                console.log((xhr.loaded / xhr.total) * 100 + '% loaded')
            }, (error) => {
                console.log(error)
            }
            );

            // lights

            div_to_scene[div_id]["color"].add( new THREE.HemisphereLight( 0x333333, 0x222222 ) );
            div_to_scene[div_id]["geo"].add( new THREE.HemisphereLight( 0x333333, 0x222222 ) );
            // addShadowedLight(div_to_scene[div_id]["color"], 1, 1, 1, 0xffffff, 1.35 / 2 );
            // addShadowedLight(div_to_scene[div_id]["color"],  0.5, 1, - 1, 0xffffff, 1 / 2 );
            // addShadowedLight(div_to_scene[div_id]["geo"], 1, 1, 1, 0xffffff, 1.35 );
            // addShadowedLight(div_to_scene[div_id]["geo"],  0.5, 1, - 1, 0xffffff, 1 );
            addShadowedLight(div_to_scene[div_id]["color"], 100, 100, 100, 0xffffff, 1.35 / 2 );
            addShadowedLight(div_to_scene[div_id]["color"], -100, 100, 100, 0xffffff, 1.35 / 2 );
            addShadowedLight(div_to_scene[div_id]["color"],  50, 100, - 100, 0xffffff, 1 / 2 );
            // addShadowedLight(div_to_scene[div_id]["geo"], 100, 100, 100, 0xffffff, 0.8 );
            // addShadowedLight(div_to_scene[div_id]["geo"], -100, 100, 100, 0xffffff, 1.2 );
            // addShadowedLight(div_to_scene[div_id]["geo"],  50, 100, - 100, 0xffffff, 1 );
            addShadowedLight(div_to_scene[div_id]["geo"], 100, 100, 100, 0xffffff, 0.8 );
            addShadowedLight(div_to_scene[div_id]["geo"], -100, 100, 100, 0xffffff, 1.2 );
            addShadowedLight(div_to_scene[div_id]["geo"],  50, 100 , -100, 0xffffff, 1 );

            // renderer

            renderer = new THREE.WebGLRenderer( { antialias: true } );
            renderer.setPixelRatio( window.devicePixelRatio );
            renderer.setSize( width, height);
            renderer.outputEncoding = THREE.sRGBEncoding;

            renderer.shadowMap.enabled = true;

            container.appendChild( renderer.domElement );

            controls = new OrbitControls(camera, renderer.domElement)
            controls.enableDamping = false

            // resize

            window.addEventListener( 'resize', onWindowResize );

    }
        function onWindowResize() {
            let width = container.clientWidth;
            let height = container.clientHeight;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize( width, height );
        }
        function animate() {
            requestAnimationFrame( animate );
            render();
        }

        function render() {
            renderer.render( div_to_scene[div_id][render_colors ? "color" : "geo"], camera );
            controls.update();
        }

        return controls;
    }

    function addShadowedLight(scene, x, y, z, color, intensity ) {

        const directionalLight = new THREE.DirectionalLight( color, intensity );
        directionalLight.position.set( x, y, z );
        scene.add( directionalLight );

        directionalLight.castShadow = true;

        const d = 1;
        directionalLight.shadow.camera.left = - d;
        directionalLight.shadow.camera.right = d;
        directionalLight.shadow.camera.top = d;
        directionalLight.shadow.camera.bottom = - d;

        directionalLight.shadow.camera.near = 1;
        directionalLight.shadow.camera.far = 4;

        directionalLight.shadow.mapSize.width = 1024;
        directionalLight.shadow.mapSize.height = 1024;

        directionalLight.shadow.bias = - 0.001;

    }

    document.addEventListener('keydown', logKey);

    function logKey(evt) {
        if (evt.keyCode === 71 && !mouse_button_down) {
            switch_geometry()
        }
        if (evt.keyCode === 82 && !mouse_button_down) {
            list_of_orbit_controls.forEach(oc => {
                console.log(oc.object.position)
            })
            reset_orbit_controls()
        }
    }

    function switch_geometry() {
        render_colors = !render_colors
    }

    function reset_orbit_controls() {
        list_of_orbit_controls.forEach(oc => {
            oc.reset()
        })
    }

    function set_style_0(){
        style_id = "0"
    }

    function set_style_1(){
        style_id = "1"
    }

    function set_style_2(){
        style_id = "2"
    }

    document.body.onmousedown = function(evt) {
        if (evt.button === 0)
            mouse_button_down = true
    }
    document.body.onmouseup = function(evt) {
        if (evt.button === 0)
            mouse_button_down = false
    }

    window.onload = function() {
        let slider = document.getElementsByClassName("slider")[0]
        slider.removeAttribute("tabIndex")
        // slider.addEventListener("mouseout", reset_orbit_controls);
        setup_render_divs("mesh_0", './assets/headcraft/random_generations/8.ply')
        setup_render_divs("mesh_1", './assets/headcraft/random_generations/1.ply')
        setup_render_divs("mesh_2", './assets/headcraft/random_generations/2.ply')
        setup_render_divs("mesh_3", './assets/headcraft/random_generations/3.ply')
        // setup_render_divs("mesh_4", './assets/headcraft/random_generations/4.ply')
        // setup_render_divs("mesh_5", './assets/headcraft/random_generations/5.ply')
        // setup_render_divs("mesh_6", './assets/headcraft/random_generations/6.ply')
        // setup_render_divs("mesh_7", './assets/headcraft/random_generations/7.ply')
    };

    </script>
<!--    <script src="js/index.js"></script>-->

</body>

</html>